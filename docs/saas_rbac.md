# SaaS系统RBAC后台权限管理

RBAC 是基于角色的访问控制（Role-Based Access Control ）在 RBAC 中，权限与角色相关联，用户通过成为适当角色的成员而得到这些角色的权限。这就极大地简化了权限的管理。这样管理都是层级相互依赖的，权限赋予给角色，而把角色又赋予用户，这样的权限设计很清楚，管理起来很方便。

## RBAC 简介

RBAC 认为授权实际上是 `Who` 、`What` 、`How` 三元组之间的关系，也就是 Who 对 What 进行 How 的操作，也就是“主体”对“客体”的操作。

- **Who**：是权限的拥有者或主体（如：User，Role）。
- **What**：是操作或对象（operation，object）。
- **How**：具体的权限（Privilege,正向授权与负向授权）。

## RBAC 支持的安全原则

- **最小权限原则**：RBAC 可以将角色配置成其完成任务所需的最小权限集合。
- **责任分离原则**：可以通过调用相互独立互斥的角色来共同完成敏感的任务，例如要求一个计账员和财务管理员共同参与统一过账操作。
- **数据抽象原则**：可以通过权限的抽象来体现，例如财务操作用借款、存款等抽象权限，而不是使用典型的读、写、执行权限。

## RBAC0、RBAC1、RBAC2、RBAC3

- RBAC0：是 RBAC 的核心思想。
- RBAC1：是把 RBAC 的角色分层模型。
- RBAC2：增加了 RBAC 的约束模型。
- RBAC3：其实是 RBAC2 + RBAC1。

### RBAC0

这是权限最基础也是最核心的模型，基本上绝大多数就是基于它来建设，包括用户、角色、权限。其中用户和角色可以是多对多的关系；角色和权限也是多对多的关系。用户是发起操作的主体，可以是业务性的访问者、可以是后台管理系统的用户。角色起到了桥梁的作用，连接了用户和权限的关系。由于角色和权限的关系是多对多，而用户与角色也是多对多的关系，所以一个用户就有一个或多个角色一个或多个系统权限（这里关于针对比较简单的系统，例如用户量很小，项目级别也很小的系统，可以采用用户直接和权限关联。也就是添加一个用户，就直接针对用户去添加对应的权限，可以没有角色的概念。针对这种情况，在此不展开讨论）。一般的系统中，引入角色（Role）就是为了提升了系统操作的效率和拓展性。权限是用户可以访问的资源，包括：页面权限、作权限、数据权限等。

### RBAC1

RBAC1 模式是RBAC0的拓展。主要是在角色上引入了角色继承（Hierarchical Role）的概念。即角色具有上下级的关系，角色间的继承关系可分为一般继承（General）和受限继承（Limited）关系。一般继承关系仅要求角色继承关系是一个绝对偏序关系，允许角色间的多继承。而受限继承关系则进一步要求角色继承关系是一个树结构，实现角色间的单继承，受限继承则增强了职责关系的分离。这种设计可以给角色分组和分层，一定程度简化了权限管理工作。

### RBAC2

RBAC2同样建立在RBAC0基础之上，仅是对用户、角色和权限三者之间增加了一些限制，实现了责任分离。RBAC2中的一个基本限制是互斥角色的限制，互斥角色是指各自权限可以互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。该模型有以下几种约束：

1) **互斥角色**：同一用户只能分配到一组互斥角色集合中至多一个角色，支持责任分离的原则。互斥角色是指各自权限互相制约的两个角色。对于这类角色一个用户在某一次活动中只能被分配其中的一个角色，不能同时获得两个角色的使用权。常举的例子：在审计活动中，一个角色不能同时被指派给会计角色和审计员角色。

2) **基数约束**：一个角色被分配的用户数量受限；一个用户可拥有的角色数目受限；同样一个角色对应的访问权限数目也应受限，以控制高级权限在系统中的分配。例如公司的领导人有限的。

3) **先决条件角色**：可以分配角色给用户仅当该用户已经是另一角色的成员；对应的可以分配访问权限给角色，仅当该角色已经拥有另一种访问权限。指要想获得较高的权限，要首先拥有低一级的权限。

4) **运行时互斥**：允许一个用户同时拥有多个角色，但在系统运行中或部分特殊场景不可同时使用这两个角色，只能使用其中一种角色。这些限制可以分成两类：即静态职责分离SSD（Static Separation of Duty）和动态职责分离DSD（Dynamic Separation of Duty）。

> **静态职责分离（SSD）**：当角色授权给用户时，需要判断当前用户是否被赋予了一个与新角色冲突的角色，冲突的角色位一个二元关系，任何一个用户在此场景下只能拥有其中一个角色。  
>
> **动态职责分离（DSD）**：在角色分配时可以将冲突的角色赋予给同一个用户，但是在用户使用系统时，一次会话中不能同时激活两个角色。

### RBAC3

即最全面的权限管理，它是基于RBAC0，将RBAC1和RBAC2进行了整合。这种模式即要维护好角色间的继承关系处理好分层，又要处理角色间的责任分离。模型公式：RBAC3 = RBAC1 + RBAC2 。

## 参考资料

- [数据库设计之权限设计](https://ld246.com/article/1583375448624)
- [万字长文：深入浅出RBAC权限设计](https://www.woshipm.com/pd/5576757.html)
- [权限体系设计：融合了组织和岗位的权限模型长啥样？](https://www.woshipm.com/it/3934803.html)
