# 什么是数据血缘

大数据时代，数据的来源极其广泛，各种类型的数据在快速产生，数据也是爆发性增长。从数据的产生，通过加工融合流转产生新的数据，到最终消亡，数据之间的关联关系可以称之为数据血缘关系。在数据中台的大背景下，数仓的开发者经常需要解决以下问题：

面对成百上千张的数据表，不知道该如何关联，也不知道这些表具有什么业务价值

执行过长，慢的无法忍受的SQL脚本，却不敢轻易进行整改

数据表是否包含机密数据需要被清理，以及这些机密数据是否被转存导致权限放大

其实，以上的这些问题都可以统一归类为数据发现问题。大部分企业会针对离线数仓任务进行SQL分析，构建表和字段的血缘关系，数据发现包括但不限于: 数据 表/列的业务分类分级和机密字段识别等。

## 数据血缘的基本概念

**数据血缘(Data Lineage)** 指的是数据从产生、ETL处理、加工、融合、流转到最终消亡，数据之间自然形成一种关系。这些关系就是描述数据的数据（**元数据**）。掌握了这个元数据，就能最大程度的做好数据的应用和管理。

## 数据血缘的常见用途

业务域的划分针对任务的表和字段，通过血缘关系可以确定表的上下游，以及对应这个表所涵盖的业务范围包括:

### 1. 提升调度性能

通过收集调度任务的开始结束时间，了解任务ETL链路的时间瓶颈，在根据JOB的执行情况定位性能瓶颈，通过调整任务的基线、保证任务的资源提供，提升整条ETL链路的执行效率。

### 2. 数据异常定位

若在某天的调度中，发现数据异常，想确认是什么造成，可根据DQC和血缘关系了解底层数据波动情况，快速定位原因。

数仓链路优化通过对表和字段的下游使用频次，找到使用较多的，分析其是否有重复计算、浪费资源的情况。再判断是否可以因此建设事实或维度表、或者把计算的指标或维度沉淀。

### 3.调度依赖的准确性判断

在平时的开发过程中，很可能修改过SQL，但是忘记在调度平台上配置相对应的依赖，这样很可能会出现问题，其实通过调度平台的调度关系的元数据，和收集到的血缘关系进行对比，可定时性的判断调度任务依赖是否准确。

## 血缘对象分类

1. 系统级血缘
2. 表级血缘
3. 字段（列）级血缘

## 数据血缘关系的4个特征

与人类社会中的血缘关系不同，数据的血缘关系包含4个特有的特征：

1) **归属性**：数据是被特定组织或个人拥有所有权的，拥有数据的组织或个人具备数据的使用权，实现营销、风险控制等目的。

2) **多源性**：这个特性与人类的血缘关系有本质的差异，同一个数据可以有多个来源。来源包括，数据是由多个数据加工生成的，或者由多种加工方式或加工步骤生成的。

3) **可追溯**：数据的血缘关系体现了数据的全生命周期，从数据生成到废弃的整个过程，均可追溯。

4) **层次性**：数据的血缘关系是具备层级关系的，就如同传统关系型数据库中，用户是级别最高的，之后依次是数据库、表、字段，他们自上而下，一个用户拥有多个数据库，一个数据库中存储着多张表，而一张表中有多个字段。他们有机结合在一起，形成完整的数据血缘关系。

## 参考资料

- [浅谈数据血缘的实现原理](https://www.51cto.com/article/741087.html)
- [浅谈数仓的元数据管理](https://zhuanlan.zhihu.com/p/336504407)
- [什么是数据血缘，如何做好数据血缘分析？](https://zhuanlan.zhihu.com/p/556604132)
