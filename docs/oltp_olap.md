# OLTP 和 OLAP

OLTP 和 OLAP：这两个术语看起来相似，但指的是不同类型的系统。在线事务处理 (OLTP) 实时捕获、存储和处理来自事务的数据。在线分析处理 (OLAP) 使用复杂的查询来分析来自 OLTP 系统的汇总历史数据。

## OLTP

### 什么是OLTP？

OLTP 是指Online Transactional Processing 的简称，这个词中 Transactional 是非常重要的，代表的是说他的处理通常包含了读以及写，通常OLTP 是指系统能够处理大量的更新以及新增的查询。所以在传统的OLTP 系统中，数据的正确性以及一致性是首要要达到的目标之一。所以一般的OLTP 中会常常听到ACID (Atomatic, Consistent, Isolated, Durable) 合规。这代表他们遵循着一个事务(Transaction) 完成后才会执行下一笔，确保整个系统的数据一致性。

数据一致性为什么这么重要？因为OLTP 可能同时有多位使用者同时操作，所以要确保当一个使用者更新资料后，另一个操作中的使用者也能拿到最终的状态。不然就可能会有数据不一致以及不同步问题。这也是为什么常常会听到ACID compliance 这个词在OLTP 中。

### 什么是ACID

**ACID**，是指数据库管理系统（DBMS）在写入或更新资料的过程中，为保证事务（transaction）是正确可靠的，所必须具备的四个特性：原子性（atomicity，或称不可分割性）、一致性（consistency）、隔离性（isolation，又称独立性）、持久性（durability）。

- **Atomicity（原子性）**：一个事务（transaction）中的所有操作，或者全部完成，或者全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。即，事务不可分割、不可约简。
- **Consistency（一致性）**：在事务开始之前和事务结束以后，资料库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设约束、触发器、级联回滚等。
- **Isolation（隔离性）**：资料库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括未提交读（Read uncommitted）、提交读（read - committed）、可重复读（repeatable read）和串行化（Serializable）。
- **Durability（持久性）**：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

### OLTP 使用的场景

当您在使用银行系统的时候就是一个非常标准使用OLTP 的系统，银行系统必须要确保您每次拿取的资料都是一致性而且是完全正确的。想像真实世界，不太可能你现在领了一些钱之后到了另一个ATM 你的金额还是维持照旧，所以银行系统都会需要很高的资料一致性，且完全符合ACID 的规范。

## OLAP

### 什么是OLAP？

OLAP 又是什么呢？它代表着Online Analytical Processing。一般的OLAP 的系统可以让数据聚合(data aggregation) 以及批次处理(Batch processing)，OLAP 大部分是用来做历史资料的分析以及报告。和OLDP 最大的不一样是他不需要处理、储存、以及保持资料的一致性，而是用OLAP 可以很快的使用Query 去得到数据洞察得到数据聚合后的结果。

### OLAP 使用场景

对于所有的BI 系统以及报告工具都是OLAP 的系统。像是如果银行中他有OLTP 的系统确保他的一致性后，他就能用OLAP 的系统去做报告以及商业智慧分析等应用。例如：他可以把所有全台湾的使用者在过去一个月的交易做分析，这时候他就会较适合使用OLAP 系统作分析。

OLAP 对从 OLTP 数据库和其他来源聚合而成的大量历史数据应用复杂查询，用于数据挖掘、分析和商业智能项目。在 OLAP 中，重点是对这些复杂查询的响应时间。每个查询都涉及从多行聚合的一列或多列数据。示例包括同比财务业绩或营销线索生成趋势。OLAP 数据库和数据仓库使分析师和决策者能够使用自定义报告工具将数据转化为信息。OLAP 中的查询失败不会中断或延迟客户的事务处理，但会延迟或影响商业智能洞察的准确性。

## 什么是 ETL？

数据必须从一个或多个 OLTP 系统移动到 OLAP 系统。很多时候，外部数据也会被获取和添加，以使分析更有意义。例如，银行可以使用从信用评级机构获得的数据以及他们自己的内部数据来进行更好的风险分析。所有这些内部和外部数据都需要处理并加载到 OLAP 或数据仓库系统中。这涉及数据提取（Extract）、转换（Transform）和加载（Load），简称为：ETL。（注：有时在加载后进行数据转换；那么这个过程称为ELT。）

## 数据仓库(Data Warehouse)与数据库

严格来说，数据库是任何结构化的数据集合。Excel电子表格，Rolodex或通讯录都是非常简单的数据库示例。Excel，Oracle或MongoDB等软件是一种数据库管理系统（DBMS），允许用户访问和管理数据库。人们通常将DBMS称为数据库。数据仓库就是一种数据库。它专注于其存储的数据-来自许多来源的历史数据-及其用途-分析。

## 数据仓库与数据湖(Data Lake)

数据库以及数据仓库的一个关键属性是它们包含结构化数据。数据存储方式（从可用的字段，日期格式以及介于两者之间的所有内容）都已事先达成协议，整个数据库都严格遵循此结构或架构。它们的相对一致性和稳定性意味着数据仓库可以为企业中多种角色的查询提供服务。这个过程非常结构化，非常可预测且非常有效，但也很难做到。

数据湖是另一种存储数据的方式，但是数据湖中的数据没有严格的结构。与数据仓库相反，数据湖中的数据
schema信息只有到真正查询的时候才会确定。这意味着将数据加载到数据湖中要容易得多，但是查询的的过程更为复杂。与数据仓库相比，数据湖中执行查询的RT时间通常更长。

## 数据仓库与数据集市(Data Mart)

如果数据仓库保存并集成了整个组织的数据，则数据集市是数据的较小子集，专门用于给定部门使用。通常，数据集市通常为单个部门构建或控制，数据通常来自于：用中央数据仓库、公司内部的其他系统数据以及公司外部的数据。数据集市通常只涉及一个主题领域，例如市场营销或销售。因为它们更小且更具体，所以它们通常更易于管理和维护，并具有更灵活的结构。

## 商业智能工具（BI工具）

BI软件是数据仓库顶部的关键层，BI工具通过对数据仓库中数据的分析，最终制定业务决策。商业智能软件具有许多不同类型的功能，但它通常包括：用于构建和执行查询的某种引擎，以及一种存储和可视化结果的方法，从而可以将其合并到包含业务分析的文档中。

## OLTP 与 OLAP 比较

|                      | OLTP                                    | OLAP |
| ----------------------- | -------------------------------------- | ----- |
|特征    |  它的特点是处理大量的短期在线交易  |它的特点是数据量大 |
|使用方法  | OLTP使用传统的数据库（DBMS）  |OLAP使用数据仓库（Data Warehouse） |
|执行频率| 高频繁读写操作，每分钟都可能会执行。 | 操作用户很少，写入频率很低，读取操作相对较多但不高频。 |
|响应时间| 毫秒级 |秒级，分钟级|
|用户数量| 允许成千上万的用户 |只允许数百个用户|
|性能指标| 事务吞吐量是性能指标|查询吞吐量是性能指标|
|目的| 专为实时业务运营而设计|专为按类别和属性分析业务度量而设计|
|表结构| OLTP 数据库中的表已标准化|OLAP 数据库中的表未规范化|
|数据源 | 运营数据。OLTP 系统是原始数据源。|合并数据。OLAP 数据来自 OLTP 数据库。|

## 总结

OLTP 重视数据处理以及一致性，OLAP 重视数据分析。但通常他们两个会搭配使用，储存资料的时候先存到OLTP 中确保数据一致性，要做分析的时候再使用OLAP 做重要报表。

## 参考资料

- [OLTP and OLAP: a practical comparison](https://www.stitchdata.com/resources/oltp-vs-olap/)
- [什么是OLTP？什么是OLAP？](https://datadrivenai.wordpress.com/2019/11/01/%E4%BB%80%E9%BA%BC%E6%98%AF-oltp%EF%BC%9F%E4%BB%80%E9%BA%BC%E6%98%AF-olap%EF%BC%9F/)
- [OLAP, OLTP, ETL and More: What You Need to Know About Data Warehouses](https://vertabelo.com/blog/what-is-data-warehousing/)
- [数据仓库VS数据湖泊，OLTP VS OLAP一篇文章说清楚](https://www.jianshu.com/p/828264b6f1d4)
- [OLAP vs. OLTP: Understanding 13 Crucial Differences](https://www.spiceworks.com/tech/artificial-intelligence/articles/olap-vs-oltp/)
